---
import { supabase } from "../lib/supabase";

Astro.request.headers.set("Cache-Control", "no-store");

const { cookies, redirect } = Astro;
const accessToken = cookies.get("sb-access-token");
const refreshToken = cookies.get("sb-refresh-token");

const urlBase = "http://localhost:4321"; //Astro.request.url.split("/signin")[0];
const url2 = new URL("/api/auth/callback", urlBase).href;
// console.log("redirect url", url2);

// if (accessToken || refreshToken) {
//   if (cookies.has("uid")) return redirect("/");
// }

const redirectURL = import.meta.env.PROD
  ? "https://app.thrivetogether.xyz/api/auth/callback"
  : url2; // import.meta.env.SITE
console.log("redirectURL", redirectURL);

const { data, error } = await supabase.auth.signInWithOAuth({
  provider: "google",
  options: {
    redirectTo: redirectURL,
  },
});

if (data?.url) {
  // redirect the user to the identity provider's authentication flow
  return redirect(data.url);
}
---

redirecting to <a href={data.url}>{data.url}</a> with redirect of {redirectURL}.
