---
const comments = [
  {
    author: "Anna C",
    activity: "completed RUNNING",
    time: "12:03 PM",
    content:
      "Ut in ad laborum minim aliqua mollit proident enim adipisicing. Pariatur nisi velit eiusmod magna mollit adipisicing ut mollit qui ad sunt mollit ipsum nisi dolore.Quis eu commodo aliquip amet est fugiat duis id ad officia voluptate. Duis esse.",
    replies: [
      {
        author: "Benjamin Foster",
        role: "Author",
        time: "08:20 AM",
        content:
          "Ipsum anim est consequat commodo reprehenderit mollit enim iure amet sit cupidatat pariatur occaecat. Velit proident est nostrud occaecat.",
      },
    ],
  },
  {
    author: "John",
    activity: "completed PAINTING",
    time: "08:10 AM",
    content:
      "Id ullamco qui tempor consectetur fugiat magna officia eiusmod ad fugiat laboris et culpa nostrud non veniam.",
    replies: [
      {
        author: "Benjamin Foster",
        role: "Author",
        time: "08:20 AM",
        content:
          "Ipsum anim est consequat commodo reprehenderit mollit enim iure amet sit cupidatat pariatur occaecat. Velit proident est nostrud occaecat.",
      },
    ],
  },
  {
    author: "Lisa",
    activity: "set a goal today to start new diet",
    time: "10:50 AM",
    content:
      "Anim aute ea ad dolore et enim aute duis laboris officia anim sit ut exercitation magna do. In nulla id exercitation veniam Lorem consectetur. Est ad commodo velit ut qui in consequat.",
    replies: [],
  },
];
---

<body class="p-4 font-sans text-slate-200">
  <div class="max-w-2xl mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
    <div class="text-center mb-6">
      <span class="text-yellow-400 text-2xl underline">
        Post new <br /> activity?
      </span>
    </div>
    <div class="text-center mb-6">
      <h2 class="text-2xl font-bold text-yellow-400">Comment (532)</h2>
      <button class="absolute top-4 right-4 text-xl text-yellow-400">&times;</button>
    </div>
    <div class="flex justify-between items-center mb-6">
      <div class="flex items-center space-x-2">
        <span class="text-yellow-400">Most recent</span>
        <span class="material-icons text-yellow-400">expand_more</span>
      </div>
    </div>
    <div>
      {comments.map((comment, index) => (
        <div class="mb-6 p-4 bg-gray-700 rounded-lg shadow-sm">
          <div class="flex justify-between items-center mb-2">
            <div>
              <span class="font-bold text-yellow-400">{comment.author}</span>
              <span class="text-gray-200">{comment.activity}</span>
            </div>
            <div class="text-sm text-gray-400">{comment.time}</div>
          </div>
          <p class="mb-4 text-gray-300">{comment.content}</p>
          <div class="flex space-x-4 text-yellow-400">
            <like-btn like-confetti-button class="flex items-center">
              <button class="material-icons mr-1" aria-label="Thumbs Up">
                thumb_up
              </button>
              <span>0</span>
            </like-btn>
            <a href="#" class="flex items-center reply-btn" data-index={index}>
              <span class="material-icons mr-1">reply</span> Reply
            </a>
            <a href="#" class="flex items-center text-red-400 delete-btn">
              <span class="material-icons mr-1">delete</span> Delete
            </a>
          </div>
          <div id={`reply-box-${index}`} class="reply-box hidden mt-4">
            <textarea
              class="w-full p-2 border rounded-lg bg-gray-600 text-slate-200 reply-content"
              placeholder="Write your reply..."
            />
            <button class="bg-yellow-400 text-black px-4 py-2 rounded-lg mt-2 submit-reply-btn">
              Submit Reply
            </button>
          </div>
        </div>
      ))}
    </div>
    <div class="text-center">
      <button class="bg-gray-700 text-yellow-400 px-4 py-2 rounded-lg">
        Show more discussion (4,512)
      </button>
    </div>
  </div>

  <script>
    import confetti from "canvas-confetti";

    document.addEventListener("DOMContentLoaded", () => {
      // Confetti button for likes
      const buttons = document.querySelectorAll("[like-confetti-button]");
      buttons.forEach((button) => {
        button.addEventListener("click", () => confetti());
      });

      // Event handlers to toggle visibility of reply submission box
      const replyButtons = document.querySelectorAll(".reply-btn");
      replyButtons.forEach((button) => {
        button.addEventListener("click", (event) => {
          event.preventDefault();
          const index = button.getAttribute("data-index");
          const replyBox = document.getElementById(`reply-box-${index}`);
          if (!replyBox) return;
          replyBox.classList.toggle("hidden");
        });
      });

      // Handle delete button click
      const deleteButtons = document.querySelectorAll(".delete-btn");
      deleteButtons.forEach((button) => {
        button.addEventListener("click", (event) => {
          event.preventDefault();
          console.log("Delete button clicked", event);
        });
      });

      // Handle submit reply button click
      const submitReplyButtons = document.querySelectorAll(".submit-reply-btn");
      submitReplyButtons.forEach((button) => {
        button.addEventListener("click", (event) => {
          const replyBox = button.closest(".reply-box");
          if (!replyBox) return;
          const content = (replyBox.querySelector(".reply-content") as HTMLTextAreaElement).value;
          console.log(`REPLY MESSAGE TO SEND: ${content}`);
        });
      });
    });

    // Custom like button element
    class LikeBtn extends HTMLElement {
      constructor() {
        super();
        let count = 0;

        const likeButton = this.querySelector("button");
        const countSpan = this.querySelector("span");

        if (likeButton && countSpan)
          likeButton.addEventListener("click", () => {
            count++;
            countSpan.textContent = count.toString();
          });
      }
    }

    customElements.define("like-btn", LikeBtn);
  </script>
</body>
